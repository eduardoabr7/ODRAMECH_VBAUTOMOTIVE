generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                          Int                           @id @default(autoincrement())
  name                        String                      
  email                       String?                       @unique
  username                    String                        @unique
  password                    String
  phone                       String?                      
  createdAt                   DateTime                      @default(now())
  updatedAt                   DateTime                      @updatedAt

  userCorporation             UserCorporation[]

  @@map("cad_user")
}

model Enterprise {
  id                          Int                           @id @default(autoincrement())
  logoUrl                     String?
  name                        String
  email                       String

  establishments              EnterpriseEstablishment[]
  users                       UserCorporation[]

  @@map("cad_enterprise")
}

model Establishment {
  id                          Int                           @id @default(autoincrement())
  name                        String
  email                       String?

  enterpriseRelations         EnterpriseEstablishment[]
  users                       UserCorporation[]

  @@map("cad_establishment")
}

model EnterpriseEstablishment {
  id_enterprise               Int
  id_establishment            Int

  enterprise                  Enterprise                    @relation(fields: [id_enterprise], references: [id])
  establishment               Establishment                 @relation(fields: [id_establishment], references: [id])

  @@id([id_enterprise, id_establishment])

  @@map("cad_enterprise_establishment")
}

model UserCorporation {
  id_user                     Int
  id_enterprise               Int
  id_establishment            Int

  role                        Role

  user                        User                          @relation(fields: [id_user], references: [id])
  enterprise                  Enterprise                    @relation(fields: [id_enterprise], references: [id])
  establishment               Establishment?                @relation(fields: [id_establishment], references: [id])

  @@id([id_user, id_enterprise, id_establishment])

  @@map("cad_user_corporation")
}

enum Role {
  ADMIN
  USER
  WORKER
}