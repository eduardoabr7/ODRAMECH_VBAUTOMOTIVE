generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id              Int               @id @default(autoincrement())
  name            String
  email           String?           @unique
  username        String            @unique
  password        String
  phone           String?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt
  addressId       Int?              @unique

  address         Address?          @relation(fields: [addressId], references: [id])
  userCorporation UserCorporation[]

  @@map("cad_user")
}

model Enterprise {
  id                Int                         @id @default(autoincrement())
  logoUrl           String?
  name              String
  email             String
  addressId         Int                         @unique

  address           Address                     @relation(fields: [addressId], references: [id])
  establishments    EnterpriseEstablishment[]
  users             UserCorporation[]

  @@map("cad_enterprise")
}

model Establishment {
  id                    Int                         @id @default(autoincrement())
  name                  String
  email                 String?
  phone                 String
  addressId             Int                         @unique

  address               Address                     @relation(fields: [addressId], references: [id])
  enterpriseRelations   EnterpriseEstablishment[]
  users                 UserCorporation[]

  @@map("cad_establishment")
}

model Address {
  id            Int             @id @default(autoincrement())
  street        String
  number        String
  complement    String?
  district      String
  city          String
  state         String
  zipCode       String
  country       String

  user          User?
  enterprise    Enterprise?
  establishment Establishment?

  @@map("cad_address")
}

model EnterpriseEstablishment {
  idEnterprise     Int
  idEstablishment  Int

  enterprise       Enterprise    @relation(fields: [idEnterprise], references: [id])
  establishment    Establishment @relation(fields: [idEstablishment], references: [id])

  @@id([idEnterprise, idEstablishment])
  @@map("cad_enterprise_establishment")
}

model UserCorporation {
  idUser            Int
  idEnterprise      Int
  idEstablishment   Int

  role              Role

  user              User          @relation(fields: [idUser], references: [id])
  enterprise        Enterprise    @relation(fields: [idEnterprise], references: [id])
  establishment     Establishment @relation(fields: [idEstablishment], references: [id])

  @@id([idUser, idEnterprise, idEstablishment])
  @@map("cad_user_corporation")
}

enum Role {
  ADMIN
  USER
  WORKER
}